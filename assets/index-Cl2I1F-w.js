(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();let i=[],E={},C={};const O=document.getElementById("csv-upload"),F=document.getElementById("image-upload"),f=document.getElementById("generate-btn"),$=document.getElementById("preview-btn"),L=document.getElementById("csv-status"),U=document.getElementById("image-status"),x=document.getElementById("card-preview"),N=document.getElementById("preview-section"),y=document.getElementById("print-area");async function A(){const t=["troops.png","mana.png","forest.png","plains.png","mountain.png","ocean.png","swamp.png","island.png","desert.png","tundra.png","jungle.png","wasteland.png"].map(async n=>{try{const c=await fetch(`./icons/${n}`);if(c.ok){const o=await c.blob();return new Promise(a=>{const r=new FileReader;r.onload=function(d){C[n]=d.target.result,console.log("Preloaded icon:",n),a()},r.readAsDataURL(o)})}else console.log(`Icon ${n} failed to load: ${c.status}`)}catch(c){console.log(`Icon ${n} not found:`,c.message)}});await Promise.all(t),console.log("All icons loaded:",Object.keys(C))}A().then(()=>{document.getElementById("test-card-display")&&B()});O.addEventListener("change",T);F.addEventListener("change",M);f.addEventListener("click",V);$.addEventListener("click",R);function T(e){const t=e.target.files[0];t&&Papa.parse(t,{header:!0,skipEmptyLines:!0,complete:function(n){i=n.data.filter(c=>c.name&&c.name.trim()!==""),console.log("Parsed card data:",i),I(L,"success",`Loaded ${i.length} cards from CSV`),S()},error:function(n){I(L,"error",`Error parsing CSV: ${n.message}`)}})}function M(e){const t=e.target.files;if(!t.length)return;let n=0;E={},Array.from(t).forEach(c=>{const o=new FileReader;o.onload=function(a){const r=c.name;E[r]=a.target.result,console.log("Loaded card image:",r),n++,n===t.length&&(I(U,"success",`Loaded ${n} card images`),S())},o.readAsDataURL(c)})}function I(e,t,n){e.className=`status ${t}`,e.textContent=n}function S(){const e=i.length>0;console.log("Updating button states - hasData:",e,"cardData.length:",i.length),f.disabled=!e,$.disabled=!e}function g(e){const t=[e,`icons/${e}`,`${e}.png`,`icons/${e}.png`];for(const n of t)if(C[n])return console.log(`Found icon "${e}" as "${n}"`),C[n];return console.log(`Icon "${e}" not found. Tried:`,t),console.log("Available icons:",Object.keys(C)),null}function b(e){const t=document.createElement("div");t.className="card";const n=document.createElement("div");n.className="card-header";const c=document.createElement("div");c.className="card-name",c.textContent=e.name||"Unnamed Card";const o=document.createElement("div");if(o.className="card-costs",e.troopCost){const s=document.createElement("div");s.className="cost-item";const l=document.createElement("img"),m=g("troops.png")||g("troops");m&&(l.src=m,l.className="cost-icon",l.alt="Troops",s.appendChild(l));const u=document.createElement("span");u.textContent=e.troopCost,s.appendChild(u),o.appendChild(s)}if(e.manaCost){const s=document.createElement("div");s.className="cost-item";const l=document.createElement("img"),m=g("mana.png")||g("mana");m&&(l.src=m,l.className="cost-icon",l.alt="Mana",s.appendChild(l));const u=document.createElement("span");u.textContent=e.manaCost,s.appendChild(u),o.appendChild(s)}n.appendChild(c),(e.troopCost||e.manaCost)&&n.appendChild(o),t.appendChild(n);const a=document.createElement("div");if(a.className="card-image",e.image&&E[e.image]){const s=document.createElement("img");s.src=E[e.image],s.alt=e.name,a.appendChild(s)}else a.classList.add("no-image"),a.textContent="No Image";if(t.appendChild(a),e.type){const s=document.createElement("div");s.className="card-type-container";const l=document.createElement("div");if(l.className="card-type",l.textContent=e.type,s.appendChild(l),e.playableOn){const m=document.createElement("div");m.className="playable-on-icons",e.playableOn.split(",").map(p=>p.trim()).filter(p=>p).forEach(p=>{const v=document.createElement("img"),P=g(`${p}.png`)||g(p);P&&(v.src=P,v.className="terrain-icon",v.alt=p,m.appendChild(v))}),s.appendChild(m)}t.appendChild(s)}const r=document.createElement("div");r.className="card-text-box",r.textContent=e.cardText||"",t.appendChild(r);const d=document.createElement("div");d.className="card-footer";const h=document.createElement("div");if(h.className="artist",h.textContent=e.artist?`Art: ${e.artist}`:"",d.appendChild(h),e.power&&e.toughness){const s=document.createElement("div");s.className="power-toughness",s.textContent=`${e.power}/${e.toughness}`,d.appendChild(s)}return t.appendChild(d),t}function R(){x.innerHTML="",i.forEach(e=>{const t=b(e);x.appendChild(t)}),N.style.display="block",N.scrollIntoView({behavior:"smooth"})}async function V(){if(i.length===0){alert("Please upload a CSV file first");return}f.textContent="Generating PDF...",f.disabled=!0;try{y.innerHTML="";const e=9,t=Math.ceil(i.length/e);for(let a=0;a<t;a++){const r=document.createElement("div");r.className="print-page";const d=a*e,h=Math.min(d+e,i.length);for(let s=d;s<h;s++){const l=b(i[s]);r.appendChild(l)}y.appendChild(r)}y.style.display="block";const{jsPDF:n}=window.jspdf,c=new n({orientation:"portrait",unit:"in",format:"letter"}),o=y.querySelectorAll(".print-page");for(let a=0;a<o.length;a++){a>0&&c.addPage();const d=(await html2canvas(o[a],{scale:2,useCORS:!0,logging:!1,width:8.5*96,height:1056})).toDataURL("image/jpeg",1);c.addImage(d,"JPEG",0,0,8.5,11)}c.save("card-templates.pdf"),y.style.display="none"}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please check the console for details.")}finally{f.textContent="Generate PDF",f.disabled=!1}}let w=null;const j=document.getElementById("update-test-card-btn"),D=document.getElementById("test-card-display"),k=document.getElementById("test-image");k.addEventListener("change",function(e){const t=e.target.files[0];if(t){const n=new FileReader;n.onload=function(c){w=c.target.result,B()},n.readAsDataURL(t)}});function B(){const e={name:document.getElementById("test-name").value||"Unnamed Card",troopCost:document.getElementById("test-troopCost").value,manaCost:document.getElementById("test-manaCost").value,playableOn:document.getElementById("test-playableOn").value,type:document.getElementById("test-type").value,cardText:document.getElementById("test-cardText").value,power:document.getElementById("test-power").value,toughness:document.getElementById("test-toughness").value,artist:document.getElementById("test-artist").value,image:"test-image"};w&&(E["test-image"]=w),D.innerHTML="";const t=b(e);D.appendChild(t)}j.addEventListener("click",B);
