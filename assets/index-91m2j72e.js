(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();let d=[],x={},S={},P=null;const _="83506289505-c5mhe4t5ig734tav216iqd15bqmtevpo.apps.googleusercontent.com",H="AIzaSyDq6q2590vojpqy50REynuollRV2Z650d8",W="https://sheets.googleapis.com/$discovery/rest?version=v4",K="https://www.googleapis.com/auth/spreadsheets.readonly https://www.googleapis.com/auth/drive.readonly",Z=document.getElementById("csv-upload"),J=document.getElementById("image-upload"),L=document.getElementById("generate-btn"),V=document.getElementById("preview-btn"),R=document.getElementById("csv-status"),Y=document.getElementById("image-status"),F=document.getElementById("card-preview"),U=document.getElementById("preview-section"),B=document.getElementById("print-area"),b=document.getElementById("google-signin-btn"),M=document.getElementById("google-signout-btn"),q=document.getElementById("google-sheets-container"),w=document.getElementById("sheets-select"),I=document.getElementById("load-sheet-btn"),h=document.getElementById("google-status"),Q=document.getElementById("user-email");async function X(){const t=["troops.png","mana.png","range.png","forest.png","plains.png","mountain.png","ocean.png","swamp.png","island.png","desert.png","tundra.png","jungle.png","wasteland.png","chaos.png","card_frame1.png"].map(async n=>{try{const s=await fetch(`./icons/${n}`);if(s.ok){const a=await s.blob();return new Promise(l=>{const r=new FileReader;r.onload=function(c){S[n]=c.target.result,console.log("Preloaded icon:",n),l()},r.readAsDataURL(a)})}else console.log(`Icon ${n} failed to load: ${s.status}`)}catch(s){console.log(`Icon ${n} not found:`,s.message)}});await Promise.all(t),console.log("All icons loaded:",Object.keys(S))}X().then(()=>{document.getElementById("test-card-display")&&A()});let k,N=!1,$=!1;window.gapiLoaded=function(){if(typeof gapi>"u"){console.error("Google API (gapi) failed to load");return}gapi.load("client",ee)};async function ee(){try{await gapi.client.init({apiKey:H,discoveryDocs:[W]}),N=!0,j()}catch(e){if(console.error("Error initializing Google API client:",e),b){const t=document.getElementById("google-signin-text");t&&(t.textContent="Google API Error (Check Console)")}}}window.gisLoaded=function(){if(typeof google>"u"){console.error("Google Identity Services (google) failed to load");return}try{k=google.accounts.oauth2.initTokenClient({client_id:_,scope:K,callback:""}),$=!0,j()}catch(e){console.error("Error initializing Google Identity Services:",e)}};function j(){if(N&&$&&b){b.disabled=!1;const e=document.getElementById("google-signin-text");e&&(e.textContent="Sign in with Google")}}function te(){if(!N||!$){m(h,"error","Google API is still loading. Please wait...");return}k.callback=async t=>{if(t.error!==void 0)throw m(h,"error","Authentication failed"),t;const n=gapi.client.getToken();P=n?n.access_token:null;try{const a=await(await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${P}`}})).json();Q.textContent=a.email}catch(s){console.error("Error fetching user info:",s)}b.style.display="none",q.style.display="block",m(h,"success","Signed in successfully!"),await oe()};const e=gapi.client.getToken();e==null?k.requestAccessToken({prompt:"consent"}):k.requestAccessToken({prompt:""})}function ne(){const e=gapi.client.getToken();e!==null&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken("")),b.style.display="block",q.style.display="none",w.innerHTML='<option value="">Select a spreadsheet...</option>',I.disabled=!0,P=null,m(h,"success","Signed out successfully")}async function oe(){try{m(h,"success","Loading spreadsheets...");const t=(await gapi.client.request({path:"https://www.googleapis.com/drive/v3/files",params:{q:"mimeType='application/vnd.google-apps.spreadsheet'",orderBy:"modifiedTime desc",pageSize:100,fields:"files(id, name)"}})).result.files;w.innerHTML='<option value="">Select a spreadsheet...</option>',t.forEach(n=>{const s=document.createElement("option");s.value=n.id,s.textContent=n.name,w.appendChild(s)}),m(h,"success",`Found ${t.length} spreadsheets`)}catch(e){console.error("Error loading spreadsheets:",e),m(h,"error","Failed to load spreadsheets")}}async function ae(){const e=w.value;if(e)try{I.textContent="Loading...",I.disabled=!0;const n=(await gapi.client.sheets.spreadsheets.get({spreadsheetId:e})).result.sheets[0].properties.title,a=(await gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:`${n}!A:Z`})).result.values;if(!a||a.length===0){m(h,"error","No data found in spreadsheet");return}const l=a[0];d=[];for(let r=1;r<a.length;r++){const c=a[r],p={};l.forEach((y,o)=>{p[y]=c[o]||""}),p.name&&p.name.trim()!==""&&d.push(p)}console.log("Loaded card data from Google Sheets:",d),m(h,"success",`Loaded ${d.length} cards from sheet`),D()}catch(t){console.error("Error loading sheet data:",t),m(h,"error","Failed to load sheet data")}finally{I.textContent="Load Selected Sheet",I.disabled=!1}}Z.addEventListener("change",se);J.addEventListener("change",le);L.addEventListener("click",ce);V.addEventListener("click",re);b&&b.addEventListener("click",te);M&&M.addEventListener("click",ne);w&&w.addEventListener("change",()=>{I.disabled=!w.value});I&&I.addEventListener("click",ae);function se(e){const t=e.target.files[0];t&&Papa.parse(t,{header:!0,skipEmptyLines:!0,complete:function(n){d=n.data.filter(s=>s.name&&s.name.trim()!==""),console.log("Parsed card data:",d),m(R,"success",`Loaded ${d.length} cards from CSV`),D()},error:function(n){m(R,"error",`Error parsing CSV: ${n.message}`)}})}function le(e){const t=e.target.files;if(!t.length)return;let n=0;x={},Array.from(t).forEach(s=>{const a=new FileReader;a.onload=function(l){const r=s.name;x[r]=l.target.result,console.log("Loaded card image:",r),n++,n===t.length&&(m(Y,"success",`Loaded ${n} card images`),D())},a.readAsDataURL(s)})}function m(e,t,n){e.className=`status ${t}`,e.textContent=n}function D(){const e=d.length>0;console.log("Updating button states - hasData:",e,"cardData.length:",d.length),L.disabled=!e,V.disabled=!e}function C(e){const t=[e,`icons/${e}`,`${e}.png`,`icons/${e}.png`];for(const n of t)if(S[n])return console.log(`Found icon "${e}" as "${n}"`),S[n];return console.log(`Icon "${e}" not found. Tried:`,t),console.log("Available icons:",Object.keys(S)),null}function O(e){const t=document.createElement("div");t.className="card",e.type&&e.type.trim().toLowerCase().startsWith("troop")&&t.classList.add("card-troop"),e.type&&e.type.trim().toLowerCase().startsWith("event")&&t.classList.add("card-event");const n=S["card_frame1.png"];if(n){let o="linear-gradient(135deg, #f4e4c1 0%, #e8d4a8 100%)";e.type&&e.type.trim().toLowerCase().startsWith("troop")?o="linear-gradient(135deg, #d4f4d4 0%, #b8e8b8 100%)":e.type&&e.type.trim().toLowerCase().startsWith("event")&&(o="linear-gradient(135deg, #f4d4d4 0%, #e8b8b8 100%)"),t.style.backgroundImage=`url(${n}), ${o}`,t.style.backgroundSize="cover, cover",t.style.backgroundPosition="center, center"}const s=document.createElement("div");s.className="card-header";const a=document.createElement("div");a.className="card-name",a.textContent=e.name||"Unnamed Card";const l=document.createElement("div");if(l.className="card-costs",e.troopCost){const o=document.createElement("div");o.className="cost-item";const g=document.createElement("img"),i=C("troops.png")||C("troops");i&&(g.src=i,g.className="cost-icon",g.alt="Troops",o.appendChild(g));const u=document.createElement("span");u.textContent=e.troopCost,o.appendChild(u),l.appendChild(o)}if(e.manaCost){const o=document.createElement("div");o.className="cost-item";const g=document.createElement("img"),i=C("mana.png")||C("mana");i&&(g.src=i,g.className="cost-icon",g.alt="Mana",o.appendChild(g));const u=document.createElement("span");u.textContent=e.manaCost,o.appendChild(u),l.appendChild(o)}s.appendChild(a),(e.troopCost||e.manaCost)&&s.appendChild(l),t.appendChild(s);const r=document.createElement("div");if(r.className="card-image",e.image&&x[e.image]){const o=document.createElement("img");o.src=x[e.image],o.alt=e.name,r.appendChild(o)}else r.classList.add("no-image"),r.textContent="No Image";if(t.appendChild(r),e.type){const o=document.createElement("div");o.className="card-type-container";const g=document.createElement("div");if(g.className="card-type",g.textContent=e.type,o.appendChild(g),e.playableOn){const i=document.createElement("div");i.className="playable-on-icons",e.playableOn.split(",").map(f=>f.trim()).filter(f=>f).forEach(f=>{const E=document.createElement("img"),G=C(`${f}.png`)||C(f);G&&(E.src=G,E.className="terrain-icon",E.alt=f,i.appendChild(E))}),o.appendChild(i)}else if(e.range){const i=document.createElement("div");i.className="playable-on-icons";const u=document.createElement("img"),f=C("range.png")||C("range");f&&(u.src=f,u.className="terrain-icon",u.alt="Range",i.appendChild(u));const E=document.createElement("span");E.textContent=e.range,E.className="range-value",i.appendChild(E),o.appendChild(i)}t.appendChild(o)}const c=document.createElement("div");if(c.className="card-text-box",e.cardText){const o=document.createElement("div");o.className="card-main-text",o.innerHTML=e.cardText,c.appendChild(o)}if(e.flavorText){const o=document.createElement("div");o.className="card-flavor-text",o.innerHTML=e.flavorText,c.appendChild(o)}t.appendChild(c);const p=document.createElement("div");p.className="card-footer";const y=document.createElement("div");if(y.className="artist",y.textContent=e.artist?`Art: ${e.artist}`:"",p.appendChild(y),e.power&&e.toughness){const o=document.createElement("div");o.className="power-toughness",o.textContent=`${e.power}/${e.toughness}`,p.appendChild(o)}return t.appendChild(p),t}function re(){F.innerHTML="",d.forEach(e=>{const t=O(e);F.appendChild(t)}),U.style.display="block",U.scrollIntoView({behavior:"smooth"})}async function ce(){if(d.length===0){alert("Please upload a CSV file first");return}L.textContent="Generating PDF...",L.disabled=!0;try{B.innerHTML="";const e=9,t=Math.ceil(d.length/e);for(let l=0;l<t;l++){const r=document.createElement("div");r.className="print-page";const c=l*e,p=Math.min(c+e,d.length);for(let y=c;y<p;y++){const o=O(d[y]);r.appendChild(o)}B.appendChild(r)}B.style.display="block";const{jsPDF:n}=window.jspdf,s=new n({orientation:"portrait",unit:"in",format:"letter"}),a=B.querySelectorAll(".print-page");for(let l=0;l<a.length;l++){l>0&&s.addPage();const c=(await html2canvas(a[l],{scale:2,useCORS:!0,logging:!1,width:8.5*96,height:1056})).toDataURL("image/jpeg",1);s.addImage(c,"JPEG",0,0,8.5,11)}s.save("card-templates.pdf"),B.style.display="none"}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please check the console for details.")}finally{L.textContent="Generate PDF",L.disabled=!1}}let T=null;const ie=document.getElementById("update-test-card-btn"),z=document.getElementById("test-card-display"),de=document.getElementById("test-image");de.addEventListener("change",function(e){const t=e.target.files[0];if(t){const n=new FileReader;n.onload=function(s){T=s.target.result,A()},n.readAsDataURL(t)}});function A(){const e={name:document.getElementById("test-name").value||"Unnamed Card",troopCost:document.getElementById("test-troopCost").value,manaCost:document.getElementById("test-manaCost").value,playableOn:document.getElementById("test-playableOn").value,type:document.getElementById("test-type").value,cardText:document.getElementById("test-cardText").value,flavorText:document.getElementById("test-flavorText").value,power:document.getElementById("test-power").value,toughness:document.getElementById("test-toughness").value,range:document.getElementById("test-range").value,artist:document.getElementById("test-artist").value,image:"test-image"};T&&(x["test-image"]=T),z.innerHTML="";const t=O(e);z.appendChild(t)}ie.addEventListener("click",A);const v=document.getElementById("download-elfs-btn");v&&v.addEventListener("click",async function(){try{v.textContent="Downloading...",v.disabled=!0;const e=new JSZip,t=e.folder("elfs"),n=["elfs.csv","00010-2446747513.png","00049-1470756094.png","00050-1789069772.png","00051-2631949519.png","00052-3663192815.png","00057-301796533.png","00062-2606519977.png","00065-1790782103.png","00077-2857751192.png","00089-2681880704.png","00097-2681880704.png","00107-2681880705.png","00117-2681880704.png","00123-2681880704.png","00130-2681880704.png","00133-2681880704.png","00135-2681880704.png","00137-2681880704.png","00138-2681880704.png","00142-2681880704.png","00143-2681880704.png","00144-2681880704.png","00145-2681880704.png"];for(const r of n)try{const c=await fetch(`./elfs/${r}`);if(c.ok){const p=await c.blob();t.file(r,p),console.log(`Added ${r} to zip`)}}catch(c){console.log(`Could not add ${r}:`,c)}const s=await e.generateAsync({type:"blob"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="elfs-example.zip",l.click(),URL.revokeObjectURL(a),v.textContent="Download Sample CSV + Photos",v.disabled=!1}catch(e){console.error("Error creating zip:",e),alert("Error creating zip file. Please check the console for details."),v.textContent="Download Sample CSV + Photos",v.disabled=!1}});
