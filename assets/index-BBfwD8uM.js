(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function o(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(a){if(a.ep)return;a.ep=!0;const s=o(a);fetch(a.href,s)}})();let d=[],x={},L={},T=null;const _="83506289505-c5mhe4t5ig734tav216iqd15bqmtevpo.apps.googleusercontent.com",H="AIzaSyDq6q2590vojpqy50REynuollRV2Z650d8",W="https://sheets.googleapis.com/$discovery/rest?version=v4",K="https://www.googleapis.com/auth/spreadsheets.readonly https://www.googleapis.com/auth/drive.readonly",Z=document.getElementById("csv-upload"),J=document.getElementById("image-upload"),b=document.getElementById("generate-btn"),V=document.getElementById("preview-btn"),A=document.getElementById("csv-status"),Y=document.getElementById("image-status"),R=document.getElementById("card-preview"),F=document.getElementById("preview-section"),B=document.getElementById("print-area"),S=document.getElementById("google-signin-btn"),U=document.getElementById("google-signout-btn"),q=document.getElementById("google-sheets-container"),I=document.getElementById("sheets-select"),w=document.getElementById("load-sheet-btn"),y=document.getElementById("google-status"),Q=document.getElementById("user-email");async function X(){const t=["troops.png","mana.png","range.png","forest.png","plains.png","mountain.png","ocean.png","swamp.png","island.png","desert.png","tundra.png","jungle.png","wasteland.png","chaos.png","card_frame1.png"].map(async o=>{try{const l=await fetch(`./icons/${o}`);if(l.ok){const a=await l.blob();return new Promise(s=>{const c=new FileReader;c.onload=function(r){L[o]=r.target.result,console.log("Preloaded icon:",o),s()},c.readAsDataURL(a)})}else console.log(`Icon ${o} failed to load: ${l.status}`)}catch(l){console.log(`Icon ${o} not found:`,l.message)}});await Promise.all(t),console.log("All icons loaded:",Object.keys(L))}X().then(()=>{document.getElementById("test-card-display")&&D()});let k,G=!1,j=!1;function ee(){gapi.load("client",te)}async function te(){await gapi.client.init({apiKey:H,discoveryDocs:[W]}),G=!0,z()}function ne(){k=google.accounts.oauth2.initTokenClient({client_id:_,scope:K,callback:""}),j=!0,z()}function z(){G&&j&&S&&(S.disabled=!1)}function oe(){k.callback=async e=>{if(e.error!==void 0)throw m(y,"error","Authentication failed"),e;T=gapi.client.getToken().access_token;try{const o=await(await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${T}`}})).json();Q.textContent=o.email}catch(t){console.error("Error fetching user info:",t)}S.style.display="none",q.style.display="block",m(y,"success","Signed in successfully!"),await se()},gapi.client.getToken()===null?k.requestAccessToken({prompt:"consent"}):k.requestAccessToken({prompt:""})}function ae(){const e=gapi.client.getToken();e!==null&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken("")),S.style.display="block",q.style.display="none",I.innerHTML='<option value="">Select a spreadsheet...</option>',w.disabled=!0,T=null,m(y,"success","Signed out successfully")}async function se(){try{m(y,"success","Loading spreadsheets...");const t=(await gapi.client.request({path:"https://www.googleapis.com/drive/v3/files",params:{q:"mimeType='application/vnd.google-apps.spreadsheet'",orderBy:"modifiedTime desc",pageSize:100,fields:"files(id, name)"}})).result.files;I.innerHTML='<option value="">Select a spreadsheet...</option>',t.forEach(o=>{const l=document.createElement("option");l.value=o.id,l.textContent=o.name,I.appendChild(l)}),m(y,"success",`Found ${t.length} spreadsheets`)}catch(e){console.error("Error loading spreadsheets:",e),m(y,"error","Failed to load spreadsheets")}}async function le(){const e=I.value;if(e)try{w.textContent="Loading...",w.disabled=!0;const o=(await gapi.client.sheets.spreadsheets.get({spreadsheetId:e})).result.sheets[0].properties.title,a=(await gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:`${o}!A:Z`})).result.values;if(!a||a.length===0){m(y,"error","No data found in spreadsheet");return}const s=a[0];d=[];for(let c=1;c<a.length;c++){const r=a[c],p={};s.forEach((h,n)=>{p[h]=r[n]||""}),p.name&&p.name.trim()!==""&&d.push(p)}console.log("Loaded card data from Google Sheets:",d),m(y,"success",`Loaded ${d.length} cards from sheet`),N()}catch(t){console.error("Error loading sheet data:",t),m(y,"error","Failed to load sheet data")}finally{w.textContent="Load Selected Sheet",w.disabled=!1}}Z.addEventListener("change",ce);J.addEventListener("change",re);b.addEventListener("click",de);V.addEventListener("click",ie);S&&S.addEventListener("click",oe);U&&U.addEventListener("click",ae);I&&I.addEventListener("change",()=>{w.disabled=!I.value});w&&w.addEventListener("click",le);window.gapiLoaded=ee;window.gisLoaded=ne;function ce(e){const t=e.target.files[0];t&&Papa.parse(t,{header:!0,skipEmptyLines:!0,complete:function(o){d=o.data.filter(l=>l.name&&l.name.trim()!==""),console.log("Parsed card data:",d),m(A,"success",`Loaded ${d.length} cards from CSV`),N()},error:function(o){m(A,"error",`Error parsing CSV: ${o.message}`)}})}function re(e){const t=e.target.files;if(!t.length)return;let o=0;x={},Array.from(t).forEach(l=>{const a=new FileReader;a.onload=function(s){const c=l.name;x[c]=s.target.result,console.log("Loaded card image:",c),o++,o===t.length&&(m(Y,"success",`Loaded ${o} card images`),N())},a.readAsDataURL(l)})}function m(e,t,o){e.className=`status ${t}`,e.textContent=o}function N(){const e=d.length>0;console.log("Updating button states - hasData:",e,"cardData.length:",d.length),b.disabled=!e,V.disabled=!e}function v(e){const t=[e,`icons/${e}`,`${e}.png`,`icons/${e}.png`];for(const o of t)if(L[o])return console.log(`Found icon "${e}" as "${o}"`),L[o];return console.log(`Icon "${e}" not found. Tried:`,t),console.log("Available icons:",Object.keys(L)),null}function $(e){const t=document.createElement("div");t.className="card",e.type&&e.type.trim().toLowerCase().startsWith("troop")&&t.classList.add("card-troop"),e.type&&e.type.trim().toLowerCase().startsWith("event")&&t.classList.add("card-event");const o=L["card_frame1.png"];if(o){let n="linear-gradient(135deg, #f4e4c1 0%, #e8d4a8 100%)";e.type&&e.type.trim().toLowerCase().startsWith("troop")?n="linear-gradient(135deg, #d4f4d4 0%, #b8e8b8 100%)":e.type&&e.type.trim().toLowerCase().startsWith("event")&&(n="linear-gradient(135deg, #f4d4d4 0%, #e8b8b8 100%)"),t.style.backgroundImage=`url(${o}), ${n}`,t.style.backgroundSize="cover, cover",t.style.backgroundPosition="center, center"}const l=document.createElement("div");l.className="card-header";const a=document.createElement("div");a.className="card-name",a.textContent=e.name||"Unnamed Card";const s=document.createElement("div");if(s.className="card-costs",e.troopCost){const n=document.createElement("div");n.className="cost-item";const g=document.createElement("img"),i=v("troops.png")||v("troops");i&&(g.src=i,g.className="cost-icon",g.alt="Troops",n.appendChild(g));const u=document.createElement("span");u.textContent=e.troopCost,n.appendChild(u),s.appendChild(n)}if(e.manaCost){const n=document.createElement("div");n.className="cost-item";const g=document.createElement("img"),i=v("mana.png")||v("mana");i&&(g.src=i,g.className="cost-icon",g.alt="Mana",n.appendChild(g));const u=document.createElement("span");u.textContent=e.manaCost,n.appendChild(u),s.appendChild(n)}l.appendChild(a),(e.troopCost||e.manaCost)&&l.appendChild(s),t.appendChild(l);const c=document.createElement("div");if(c.className="card-image",e.image&&x[e.image]){const n=document.createElement("img");n.src=x[e.image],n.alt=e.name,c.appendChild(n)}else c.classList.add("no-image"),c.textContent="No Image";if(t.appendChild(c),e.type){const n=document.createElement("div");n.className="card-type-container";const g=document.createElement("div");if(g.className="card-type",g.textContent=e.type,n.appendChild(g),e.playableOn){const i=document.createElement("div");i.className="playable-on-icons",e.playableOn.split(",").map(f=>f.trim()).filter(f=>f).forEach(f=>{const E=document.createElement("img"),O=v(`${f}.png`)||v(f);O&&(E.src=O,E.className="terrain-icon",E.alt=f,i.appendChild(E))}),n.appendChild(i)}else if(e.range){const i=document.createElement("div");i.className="playable-on-icons";const u=document.createElement("img"),f=v("range.png")||v("range");f&&(u.src=f,u.className="terrain-icon",u.alt="Range",i.appendChild(u));const E=document.createElement("span");E.textContent=e.range,E.className="range-value",i.appendChild(E),n.appendChild(i)}t.appendChild(n)}const r=document.createElement("div");if(r.className="card-text-box",e.cardText){const n=document.createElement("div");n.className="card-main-text",n.innerHTML=e.cardText,r.appendChild(n)}if(e.flavorText){const n=document.createElement("div");n.className="card-flavor-text",n.innerHTML=e.flavorText,r.appendChild(n)}t.appendChild(r);const p=document.createElement("div");p.className="card-footer";const h=document.createElement("div");if(h.className="artist",h.textContent=e.artist?`Art: ${e.artist}`:"",p.appendChild(h),e.power&&e.toughness){const n=document.createElement("div");n.className="power-toughness",n.textContent=`${e.power}/${e.toughness}`,p.appendChild(n)}return t.appendChild(p),t}function ie(){R.innerHTML="",d.forEach(e=>{const t=$(e);R.appendChild(t)}),F.style.display="block",F.scrollIntoView({behavior:"smooth"})}async function de(){if(d.length===0){alert("Please upload a CSV file first");return}b.textContent="Generating PDF...",b.disabled=!0;try{B.innerHTML="";const e=9,t=Math.ceil(d.length/e);for(let s=0;s<t;s++){const c=document.createElement("div");c.className="print-page";const r=s*e,p=Math.min(r+e,d.length);for(let h=r;h<p;h++){const n=$(d[h]);c.appendChild(n)}B.appendChild(c)}B.style.display="block";const{jsPDF:o}=window.jspdf,l=new o({orientation:"portrait",unit:"in",format:"letter"}),a=B.querySelectorAll(".print-page");for(let s=0;s<a.length;s++){s>0&&l.addPage();const r=(await html2canvas(a[s],{scale:2,useCORS:!0,logging:!1,width:8.5*96,height:1056})).toDataURL("image/jpeg",1);l.addImage(r,"JPEG",0,0,8.5,11)}l.save("card-templates.pdf"),B.style.display="none"}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please check the console for details.")}finally{b.textContent="Generate PDF",b.disabled=!1}}let P=null;const pe=document.getElementById("update-test-card-btn"),M=document.getElementById("test-card-display"),ge=document.getElementById("test-image");ge.addEventListener("change",function(e){const t=e.target.files[0];if(t){const o=new FileReader;o.onload=function(l){P=l.target.result,D()},o.readAsDataURL(t)}});function D(){const e={name:document.getElementById("test-name").value||"Unnamed Card",troopCost:document.getElementById("test-troopCost").value,manaCost:document.getElementById("test-manaCost").value,playableOn:document.getElementById("test-playableOn").value,type:document.getElementById("test-type").value,cardText:document.getElementById("test-cardText").value,flavorText:document.getElementById("test-flavorText").value,power:document.getElementById("test-power").value,toughness:document.getElementById("test-toughness").value,range:document.getElementById("test-range").value,artist:document.getElementById("test-artist").value,image:"test-image"};P&&(x["test-image"]=P),M.innerHTML="";const t=$(e);M.appendChild(t)}pe.addEventListener("click",D);const C=document.getElementById("download-elfs-btn");C&&C.addEventListener("click",async function(){try{C.textContent="Downloading...",C.disabled=!0;const e=new JSZip,t=e.folder("elfs"),o=["elfs.csv","00010-2446747513.png","00049-1470756094.png","00050-1789069772.png","00051-2631949519.png","00052-3663192815.png","00057-301796533.png","00062-2606519977.png","00065-1790782103.png","00077-2857751192.png","00089-2681880704.png","00097-2681880704.png","00107-2681880705.png","00117-2681880704.png","00123-2681880704.png","00130-2681880704.png","00133-2681880704.png","00135-2681880704.png","00137-2681880704.png","00138-2681880704.png","00142-2681880704.png","00143-2681880704.png","00144-2681880704.png","00145-2681880704.png"];for(const c of o)try{const r=await fetch(`./elfs/${c}`);if(r.ok){const p=await r.blob();t.file(c,p),console.log(`Added ${c} to zip`)}}catch(r){console.log(`Could not add ${c}:`,r)}const l=await e.generateAsync({type:"blob"}),a=URL.createObjectURL(l),s=document.createElement("a");s.href=a,s.download="elfs-example.zip",s.click(),URL.revokeObjectURL(a),C.textContent="Download Sample CSV + Photos",C.disabled=!1}catch(e){console.error("Error creating zip:",e),alert("Error creating zip file. Please check the console for details."),C.textContent="Download Sample CSV + Photos",C.disabled=!1}});
