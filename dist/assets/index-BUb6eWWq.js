(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();let u=[],v={},E={};const S=document.getElementById("csv-upload"),O=document.getElementById("image-upload"),h=document.getElementById("generate-btn"),D=document.getElementById("preview-btn"),L=document.getElementById("csv-status"),F=document.getElementById("image-status"),N=document.getElementById("card-preview"),P=document.getElementById("preview-section"),y=document.getElementById("print-area");async function M(){const t=["troops.png","mana.png","range.png","forest.png","plains.png","mountain.png","ocean.png","swamp.png","island.png","desert.png","tundra.png","jungle.png","wasteland.png","chaos.png"].map(async a=>{try{const c=await fetch(`./icons/${a}`);if(c.ok){const s=await c.blob();return new Promise(o=>{const r=new FileReader;r.onload=function(i){E[a]=i.target.result,console.log("Preloaded icon:",a),o()},r.readAsDataURL(s)})}else console.log(`Icon ${a} failed to load: ${c.status}`)}catch(c){console.log(`Icon ${a} not found:`,c.message)}});await Promise.all(t),console.log("All icons loaded:",Object.keys(E))}M().then(()=>{document.getElementById("test-card-display")&&x()});S.addEventListener("change",U);O.addEventListener("change",A);h.addEventListener("click",V);D.addEventListener("click",R);function U(e){const t=e.target.files[0];t&&Papa.parse(t,{header:!0,skipEmptyLines:!0,complete:function(a){u=a.data.filter(c=>c.name&&c.name.trim()!==""),console.log("Parsed card data:",u),I(L,"success",`Loaded ${u.length} cards from CSV`),$()},error:function(a){I(L,"error",`Error parsing CSV: ${a.message}`)}})}function A(e){const t=e.target.files;if(!t.length)return;let a=0;v={},Array.from(t).forEach(c=>{const s=new FileReader;s.onload=function(o){const r=c.name;v[r]=o.target.result,console.log("Loaded card image:",r),a++,a===t.length&&(I(F,"success",`Loaded ${a} card images`),$())},s.readAsDataURL(c)})}function I(e,t,a){e.className=`status ${t}`,e.textContent=a}function $(){const e=u.length>0;console.log("Updating button states - hasData:",e,"cardData.length:",u.length),h.disabled=!e,D.disabled=!e}function f(e){const t=[e,`icons/${e}`,`${e}.png`,`icons/${e}.png`];for(const a of t)if(E[a])return console.log(`Found icon "${e}" as "${a}"`),E[a];return console.log(`Icon "${e}" not found. Tried:`,t),console.log("Available icons:",Object.keys(E)),null}function b(e){const t=document.createElement("div");t.className="card",e.type&&e.type.trim().toLowerCase().startsWith("troop")&&t.classList.add("card-troop");const a=document.createElement("div");a.className="card-header";const c=document.createElement("div");c.className="card-name",c.textContent=e.name||"Unnamed Card";const s=document.createElement("div");if(s.className="card-costs",e.troopCost){const n=document.createElement("div");n.className="cost-item";const l=document.createElement("img"),d=f("troops.png")||f("troops");d&&(l.src=d,l.className="cost-icon",l.alt="Troops",n.appendChild(l));const m=document.createElement("span");m.textContent=e.troopCost,n.appendChild(m),s.appendChild(n)}if(e.manaCost){const n=document.createElement("div");n.className="cost-item";const l=document.createElement("img"),d=f("mana.png")||f("mana");d&&(l.src=d,l.className="cost-icon",l.alt="Mana",n.appendChild(l));const m=document.createElement("span");m.textContent=e.manaCost,n.appendChild(m),s.appendChild(n)}a.appendChild(c),(e.troopCost||e.manaCost)&&a.appendChild(s),t.appendChild(a);const o=document.createElement("div");if(o.className="card-image",e.image&&v[e.image]){const n=document.createElement("img");n.src=v[e.image],n.alt=e.name,o.appendChild(n)}else o.classList.add("no-image"),o.textContent="No Image";if(t.appendChild(o),e.type){const n=document.createElement("div");n.className="card-type-container";const l=document.createElement("div");if(l.className="card-type",l.textContent=e.type,n.appendChild(l),e.playableOn){const d=document.createElement("div");d.className="playable-on-icons",e.playableOn.split(",").map(p=>p.trim()).filter(p=>p).forEach(p=>{const g=document.createElement("img"),B=f(`${p}.png`)||f(p);B&&(g.src=B,g.className="terrain-icon",g.alt=p,d.appendChild(g))}),n.appendChild(d)}else if(e.range){const d=document.createElement("div");d.className="playable-on-icons";const m=document.createElement("img"),p=f("range.png")||f("range");p&&(m.src=p,m.className="terrain-icon",m.alt="Range",d.appendChild(m));const g=document.createElement("span");g.textContent=e.range,g.className="range-value",d.appendChild(g),n.appendChild(d)}t.appendChild(n)}const r=document.createElement("div");if(r.className="card-text-box",e.cardText){const n=document.createElement("div");n.className="card-main-text",n.innerHTML=e.cardText,r.appendChild(n)}if(e.flavorText){const n=document.createElement("div");n.className="card-flavor-text",n.innerHTML=e.flavorText,r.appendChild(n)}t.appendChild(r);const i=document.createElement("div");i.className="card-footer";const C=document.createElement("div");if(C.className="artist",C.textContent=e.artist?`Art: ${e.artist}`:"",i.appendChild(C),e.power&&e.toughness){const n=document.createElement("div");n.className="power-toughness",n.textContent=`${e.power}/${e.toughness}`,i.appendChild(n)}return t.appendChild(i),t}function R(){N.innerHTML="",u.forEach(e=>{const t=b(e);N.appendChild(t)}),P.style.display="block",P.scrollIntoView({behavior:"smooth"})}async function V(){if(u.length===0){alert("Please upload a CSV file first");return}h.textContent="Generating PDF...",h.disabled=!0;try{y.innerHTML="";const e=9,t=Math.ceil(u.length/e);for(let o=0;o<t;o++){const r=document.createElement("div");r.className="print-page";const i=o*e,C=Math.min(i+e,u.length);for(let n=i;n<C;n++){const l=b(u[n]);r.appendChild(l)}y.appendChild(r)}y.style.display="block";const{jsPDF:a}=window.jspdf,c=new a({orientation:"portrait",unit:"in",format:"letter"}),s=y.querySelectorAll(".print-page");for(let o=0;o<s.length;o++){o>0&&c.addPage();const i=(await html2canvas(s[o],{scale:2,useCORS:!0,logging:!1,width:8.5*96,height:1056})).toDataURL("image/jpeg",1);c.addImage(i,"JPEG",0,0,8.5,11)}c.save("card-templates.pdf"),y.style.display="none"}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please check the console for details.")}finally{h.textContent="Generate PDF",h.disabled=!1}}let w=null;const j=document.getElementById("update-test-card-btn"),T=document.getElementById("test-card-display"),k=document.getElementById("test-image");k.addEventListener("change",function(e){const t=e.target.files[0];if(t){const a=new FileReader;a.onload=function(c){w=c.target.result,x()},a.readAsDataURL(t)}});function x(){const e={name:document.getElementById("test-name").value||"Unnamed Card",troopCost:document.getElementById("test-troopCost").value,manaCost:document.getElementById("test-manaCost").value,playableOn:document.getElementById("test-playableOn").value,type:document.getElementById("test-type").value,cardText:document.getElementById("test-cardText").value,flavorText:document.getElementById("test-flavorText").value,power:document.getElementById("test-power").value,toughness:document.getElementById("test-toughness").value,range:document.getElementById("test-range").value,artist:document.getElementById("test-artist").value,image:"test-image"};w&&(v["test-image"]=w),T.innerHTML="";const t=b(e);T.appendChild(t)}j.addEventListener("click",x);
