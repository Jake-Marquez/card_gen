(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();let d=[],y={},v={};const O=document.getElementById("csv-upload"),F=document.getElementById("image-upload"),f=document.getElementById("generate-btn"),$=document.getElementById("preview-btn"),N=document.getElementById("csv-status"),T=document.getElementById("image-status"),P=document.getElementById("card-preview"),x=document.getElementById("preview-section"),C=document.getElementById("print-area");async function U(){const e=["troops.png","mana.png","forest.png","plains.png","mountain.png","ocean.png","swamp.png","island.png","desert.png","tundra.png","jungle.png","wasteland.png"];for(const t of e)try{const a=await fetch(`/icons/${t}`);if(a.ok){const c=await a.blob(),o=new FileReader;o.onload=function(n){v[t]=n.target.result,console.log("Preloaded icon:",t)},o.readAsDataURL(c)}}catch{console.log(`Icon ${t} not found in /icons/ folder`)}}U();O.addEventListener("change",A);F.addEventListener("change",M);f.addEventListener("click",V);$.addEventListener("click",R);function A(e){const t=e.target.files[0];t&&Papa.parse(t,{header:!0,skipEmptyLines:!0,complete:function(a){d=a.data.filter(c=>c.name&&c.name.trim()!==""),console.log("Parsed card data:",d),I(N,"success",`Loaded ${d.length} cards from CSV`),S()},error:function(a){I(N,"error",`Error parsing CSV: ${a.message}`)}})}function M(e){const t=e.target.files;if(!t.length)return;let a=0;y={},Array.from(t).forEach(c=>{const o=new FileReader;o.onload=function(n){const r=c.name;y[r]=n.target.result,console.log("Loaded card image:",r),a++,a===t.length&&(I(T,"success",`Loaded ${a} card images`),S())},o.readAsDataURL(c)})}function I(e,t,a){e.className=`status ${t}`,e.textContent=a}function S(){const e=d.length>0;console.log("Updating button states - hasData:",e,"cardData.length:",d.length),f.disabled=!e,$.disabled=!e}function g(e){const t=[e,`icons/${e}`,`${e}.png`,`icons/${e}.png`];for(const a of t)if(v[a])return console.log(`Found icon "${e}" as "${a}"`),v[a];return console.log(`Icon "${e}" not found. Tried:`,t),console.log("Available icons:",Object.keys(v)),null}function w(e){const t=document.createElement("div");t.className="card";const a=document.createElement("div");a.className="card-header";const c=document.createElement("div");c.className="card-name",c.textContent=e.name||"Unnamed Card";const o=document.createElement("div");if(o.className="card-costs",e.troopCost){const s=document.createElement("div");s.className="cost-item";const l=document.createElement("img"),m=g("troops.png")||g("troops");m&&(l.src=m,l.className="cost-icon",l.alt="Troops",s.appendChild(l));const u=document.createElement("span");u.textContent=e.troopCost,s.appendChild(u),o.appendChild(s)}if(e.manaCost){const s=document.createElement("div");s.className="cost-item";const l=document.createElement("img"),m=g("mana.png")||g("mana");m&&(l.src=m,l.className="cost-icon",l.alt="Mana",s.appendChild(l));const u=document.createElement("span");u.textContent=e.manaCost,s.appendChild(u),o.appendChild(s)}a.appendChild(c),(e.troopCost||e.manaCost)&&a.appendChild(o),t.appendChild(a);const n=document.createElement("div");if(n.className="card-image",e.image&&y[e.image]){const s=document.createElement("img");s.src=y[e.image],s.alt=e.name,n.appendChild(s)}else n.classList.add("no-image"),n.textContent="No Image";if(t.appendChild(n),e.type){const s=document.createElement("div");s.className="card-type-container";const l=document.createElement("div");if(l.className="card-type",l.textContent=e.type,s.appendChild(l),e.playableOn){const m=document.createElement("div");m.className="playable-on-icons",e.playableOn.split(",").map(p=>p.trim()).filter(p=>p).forEach(p=>{const E=document.createElement("img"),L=g(`${p}.png`)||g(p);L&&(E.src=L,E.className="terrain-icon",E.alt=p,m.appendChild(E))}),s.appendChild(m)}t.appendChild(s)}const r=document.createElement("div");r.className="card-text-box",r.textContent=e.cardText||"",t.appendChild(r);const i=document.createElement("div");i.className="card-footer";const h=document.createElement("div");if(h.className="artist",h.textContent=e.artist?`Art: ${e.artist}`:"",i.appendChild(h),e.power&&e.toughness){const s=document.createElement("div");s.className="power-toughness",s.textContent=`${e.power}/${e.toughness}`,i.appendChild(s)}return t.appendChild(i),t}function R(){P.innerHTML="",d.forEach(e=>{const t=w(e);P.appendChild(t)}),x.style.display="block",x.scrollIntoView({behavior:"smooth"})}async function V(){if(d.length===0){alert("Please upload a CSV file first");return}f.textContent="Generating PDF...",f.disabled=!0;try{C.innerHTML="";const e=9,t=Math.ceil(d.length/e);for(let n=0;n<t;n++){const r=document.createElement("div");r.className="print-page";const i=n*e,h=Math.min(i+e,d.length);for(let s=i;s<h;s++){const l=w(d[s]);r.appendChild(l)}C.appendChild(r)}C.style.display="block";const{jsPDF:a}=window.jspdf,c=new a({orientation:"portrait",unit:"in",format:"letter"}),o=C.querySelectorAll(".print-page");for(let n=0;n<o.length;n++){n>0&&c.addPage();const i=(await html2canvas(o[n],{scale:2,useCORS:!0,logging:!1,width:8.5*96,height:1056})).toDataURL("image/jpeg",1);c.addImage(i,"JPEG",0,0,8.5,11)}c.save("card-templates.pdf"),C.style.display="none"}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please check the console for details.")}finally{f.textContent="Generate PDF",f.disabled=!1}}let b=null;const j=document.getElementById("update-test-card-btn"),D=document.getElementById("test-card-display"),k=document.getElementById("test-image");k.addEventListener("change",function(e){const t=e.target.files[0];if(t){const a=new FileReader;a.onload=function(c){b=c.target.result,B()},a.readAsDataURL(t)}});function B(){const e={name:document.getElementById("test-name").value||"Unnamed Card",troopCost:document.getElementById("test-troopCost").value,manaCost:document.getElementById("test-manaCost").value,playableOn:document.getElementById("test-playableOn").value,type:document.getElementById("test-type").value,cardText:document.getElementById("test-cardText").value,power:document.getElementById("test-power").value,toughness:document.getElementById("test-toughness").value,artist:document.getElementById("test-artist").value,image:"test-image"};b&&(y["test-image"]=b),D.innerHTML="";const t=w(e);D.appendChild(t)}j.addEventListener("click",B);setTimeout(()=>{B()},500);
