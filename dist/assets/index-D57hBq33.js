(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();let g=[],I={},v={};const O=document.getElementById("csv-upload"),U=document.getElementById("image-upload"),C=document.getElementById("generate-btn"),$=document.getElementById("preview-btn"),P=document.getElementById("csv-status"),F=document.getElementById("image-status"),N=document.getElementById("card-preview"),D=document.getElementById("preview-section"),E=document.getElementById("print-area");async function R(){const t=["troops.png","mana.png","range.png","forest.png","plains.png","mountain.png","ocean.png","swamp.png","island.png","desert.png","tundra.png","jungle.png","wasteland.png","chaos.png"].map(async o=>{try{const c=await fetch(`./icons/${o}`);if(c.ok){const s=await c.blob();return new Promise(a=>{const l=new FileReader;l.onload=function(r){v[o]=r.target.result,console.log("Preloaded icon:",o),a()},l.readAsDataURL(s)})}else console.log(`Icon ${o} failed to load: ${c.status}`)}catch(c){console.log(`Icon ${o} not found:`,c.message)}});await Promise.all(t),console.log("All icons loaded:",Object.keys(v))}R().then(()=>{document.getElementById("test-card-display")&&x()});O.addEventListener("change",A);U.addEventListener("change",M);C.addEventListener("click",V);$.addEventListener("click",k);function A(e){const t=e.target.files[0];t&&Papa.parse(t,{header:!0,skipEmptyLines:!0,complete:function(o){g=o.data.filter(c=>c.name&&c.name.trim()!==""),console.log("Parsed card data:",g),b(P,"success",`Loaded ${g.length} cards from CSV`),T()},error:function(o){b(P,"error",`Error parsing CSV: ${o.message}`)}})}function M(e){const t=e.target.files;if(!t.length)return;let o=0;I={},Array.from(t).forEach(c=>{const s=new FileReader;s.onload=function(a){const l=c.name;I[l]=a.target.result,console.log("Loaded card image:",l),o++,o===t.length&&(b(F,"success",`Loaded ${o} card images`),T())},s.readAsDataURL(c)})}function b(e,t,o){e.className=`status ${t}`,e.textContent=o}function T(){const e=g.length>0;console.log("Updating button states - hasData:",e,"cardData.length:",g.length),C.disabled=!e,$.disabled=!e}function f(e){const t=[e,`icons/${e}`,`${e}.png`,`icons/${e}.png`];for(const o of t)if(v[o])return console.log(`Found icon "${e}" as "${o}"`),v[o];return console.log(`Icon "${e}" not found. Tried:`,t),console.log("Available icons:",Object.keys(v)),null}function L(e){const t=document.createElement("div");t.className="card",e.type&&e.type.trim().toLowerCase().startsWith("troop")&&t.classList.add("card-troop"),e.type&&e.type.trim().toLowerCase().startsWith("event")&&t.classList.add("card-event");const o=document.createElement("div");o.className="card-header";const c=document.createElement("div");c.className="card-name",c.textContent=e.name||"Unnamed Card";const s=document.createElement("div");if(s.className="card-costs",e.troopCost){const n=document.createElement("div");n.className="cost-item";const d=document.createElement("img"),i=f("troops.png")||f("troops");i&&(d.src=i,d.className="cost-icon",d.alt="Troops",n.appendChild(d));const m=document.createElement("span");m.textContent=e.troopCost,n.appendChild(m),s.appendChild(n)}if(e.manaCost){const n=document.createElement("div");n.className="cost-item";const d=document.createElement("img"),i=f("mana.png")||f("mana");i&&(d.src=i,d.className="cost-icon",d.alt="Mana",n.appendChild(d));const m=document.createElement("span");m.textContent=e.manaCost,n.appendChild(m),s.appendChild(n)}o.appendChild(c),(e.troopCost||e.manaCost)&&o.appendChild(s),t.appendChild(o);const a=document.createElement("div");if(a.className="card-image",e.image&&I[e.image]){const n=document.createElement("img");n.src=I[e.image],n.alt=e.name,a.appendChild(n)}else a.classList.add("no-image"),a.textContent="No Image";if(t.appendChild(a),e.type){const n=document.createElement("div");n.className="card-type-container";const d=document.createElement("div");if(d.className="card-type",d.textContent=e.type,n.appendChild(d),e.playableOn){const i=document.createElement("div");i.className="playable-on-icons",e.playableOn.split(",").map(p=>p.trim()).filter(p=>p).forEach(p=>{const u=document.createElement("img"),B=f(`${p}.png`)||f(p);B&&(u.src=B,u.className="terrain-icon",u.alt=p,i.appendChild(u))}),n.appendChild(i)}else if(e.range){const i=document.createElement("div");i.className="playable-on-icons";const m=document.createElement("img"),p=f("range.png")||f("range");p&&(m.src=p,m.className="terrain-icon",m.alt="Range",i.appendChild(m));const u=document.createElement("span");u.textContent=e.range,u.className="range-value",i.appendChild(u),n.appendChild(i)}t.appendChild(n)}const l=document.createElement("div");if(l.className="card-text-box",e.cardText){const n=document.createElement("div");n.className="card-main-text",n.innerHTML=e.cardText,l.appendChild(n)}if(e.flavorText){const n=document.createElement("div");n.className="card-flavor-text",n.innerHTML=e.flavorText,l.appendChild(n)}t.appendChild(l);const r=document.createElement("div");r.className="card-footer";const y=document.createElement("div");if(y.className="artist",y.textContent=e.artist?`Art: ${e.artist}`:"",r.appendChild(y),e.power&&e.toughness){const n=document.createElement("div");n.className="power-toughness",n.textContent=`${e.power}/${e.toughness}`,r.appendChild(n)}return t.appendChild(r),t}function k(){N.innerHTML="",g.forEach(e=>{const t=L(e);N.appendChild(t)}),D.style.display="block",D.scrollIntoView({behavior:"smooth"})}async function V(){if(g.length===0){alert("Please upload a CSV file first");return}C.textContent="Generating PDF...",C.disabled=!0;try{E.innerHTML="";const e=9,t=Math.ceil(g.length/e);for(let a=0;a<t;a++){const l=document.createElement("div");l.className="print-page";const r=a*e,y=Math.min(r+e,g.length);for(let n=r;n<y;n++){const d=L(g[n]);l.appendChild(d)}E.appendChild(l)}E.style.display="block";const{jsPDF:o}=window.jspdf,c=new o({orientation:"portrait",unit:"in",format:"letter"}),s=E.querySelectorAll(".print-page");for(let a=0;a<s.length;a++){a>0&&c.addPage();const r=(await html2canvas(s[a],{scale:2,useCORS:!0,logging:!1,width:8.5*96,height:1056})).toDataURL("image/jpeg",1);c.addImage(r,"JPEG",0,0,8.5,11)}c.save("card-templates.pdf"),E.style.display="none"}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please check the console for details.")}finally{C.textContent="Generate PDF",C.disabled=!1}}let w=null;const j=document.getElementById("update-test-card-btn"),S=document.getElementById("test-card-display"),z=document.getElementById("test-image");z.addEventListener("change",function(e){const t=e.target.files[0];if(t){const o=new FileReader;o.onload=function(c){w=c.target.result,x()},o.readAsDataURL(t)}});function x(){const e={name:document.getElementById("test-name").value||"Unnamed Card",troopCost:document.getElementById("test-troopCost").value,manaCost:document.getElementById("test-manaCost").value,playableOn:document.getElementById("test-playableOn").value,type:document.getElementById("test-type").value,cardText:document.getElementById("test-cardText").value,flavorText:document.getElementById("test-flavorText").value,power:document.getElementById("test-power").value,toughness:document.getElementById("test-toughness").value,range:document.getElementById("test-range").value,artist:document.getElementById("test-artist").value,image:"test-image"};w&&(I["test-image"]=w),S.innerHTML="";const t=L(e);S.appendChild(t)}j.addEventListener("click",x);const h=document.getElementById("download-elfs-btn");h&&h.addEventListener("click",async function(){try{h.textContent="Downloading...",h.disabled=!0;const e=new JSZip,t=e.folder("elfs"),o=["elfs.csv","00010-2446747513.png","00049-1470756094.png","00050-1789069772.png","00051-2631949519.png","00052-3663192815.png","00057-301796533.png","00062-2606519977.png","00065-1790782103.png","00077-2857751192.png","00089-2681880704.png","00097-2681880704.png","00107-2681880705.png","00117-2681880704.png","00123-2681880704.png","00130-2681880704.png","00133-2681880704.png","00135-2681880704.png","00137-2681880704.png","00138-2681880704.png","00142-2681880704.png","00143-2681880704.png","00144-2681880704.png","00145-2681880704.png"];for(const l of o)try{const r=await fetch(`./elfs/${l}`);if(r.ok){const y=await r.blob();t.file(l,y),console.log(`Added ${l} to zip`)}}catch(r){console.log(`Could not add ${l}:`,r)}const c=await e.generateAsync({type:"blob"}),s=URL.createObjectURL(c),a=document.createElement("a");a.href=s,a.download="elfs-example.zip",a.click(),URL.revokeObjectURL(s),h.textContent="Download Sample CSV + Photos",h.disabled=!1}catch(e){console.error("Error creating zip:",e),alert("Error creating zip file. Please check the console for details."),h.textContent="Download Sample CSV + Photos",h.disabled=!1}});
